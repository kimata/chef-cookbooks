# Generated by Chef for <%= node['fqdn'] %>

mydomain                    = <%= node['domain'] %>
myhostname                  = <%= node['hostname'] %>.$mydomain
myorigin                    = $mydomain
    
inet_interfaces             = all
mydestination               = $myhostname, localhost.$mydomain, $mydomain
unknown_local_recipient_reject_code = 550

mynetworks_style            = subnet
mynetworks                  = 192.168.2.0/24, 127.0.0.0/8

relay_domains               = $mydestination

relayhost                   = [mail.nk.rim.or.jp]:587
smtp_sasl_auth_enable       = yes
smtp_sasl_password_maps     = hash:/etc/postfix/relaypass
smtp_sasl_security_options  = noanonymous

in_flow_delay               = 1s

alias_maps                  = hash:/etc/aliases
alias_database              = $alias_maps

home_mailbox                = mail/
mailbox_command             = /usr/bin/spamc | /usr/bin/scmail-deliver
allow_mail_to_commands      = alias,forward,include

local_destination_concurrency_limit = 2
default_destination_concurrency_limit = 20

recipient_delimiter         = +

smtpd_banner                = $myhostname ESMTP $mail_name Ubuntu Special :-)
smtpd_sasl_auth_enable      = yes
smtpd_sasl_security_options = noanonymous, noplaintext
smtpd_sasl_local_domain     = $myhostname
smtpd_recipient_restrictions= permit_mynetworks, permit_auth_destination, permit_sasl_authenticated, reject_unauth_destination

mailbox_size_limit          = 0
message_size_limit          = 52428800

queue_run_delay             = 180s
bounce_queue_lifetime       = 12h
maximal_queue_lifetime      = 12h
minimal_backoff_time        = 3m 
maximal_backoff_time        = 30m 
